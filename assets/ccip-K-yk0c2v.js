import{$ as e,A as t,C as n,D as r,E as i,G as a,J as o,K as s,M as c,N as l,O as u,Q as d,S as f,T as p,U as m,W as h,X as g,Y as _,Z as v,j as y,k as b,n as x,q as S,w as C,x as w}from"./index-Qrot8-Du.js";function T(e){let{abi:t,data:n}=e,i=c(n,0,4),a=t.find(e=>e.type===`function`&&i===r(d(e)));if(!a)throw new o(i,{docsPath:`/docs/contract/decodeFunctionData`});return{functionName:a.name,args:`inputs`in a&&a.inputs&&a.inputs.length>0?u(a.inputs,c(n,4)):void 0}}var E=`/docs/contract/encodeErrorResult`;function D(e){let{abi:t,errorName:n,args:o}=e,s=t[0];if(n){let e=i({abi:t,args:o,name:n});if(!e)throw new a(n,{docsPath:E});s=e}if(s.type!==`error`)throw new a(void 0,{docsPath:E});let c=r(d(s)),l=`0x`;if(o&&o.length>0){if(!s.inputs)throw new h(s.name,{docsPath:E});l=b(s.inputs,o)}return y([c,l])}var O=`/docs/contract/encodeFunctionResult`;function k(e){let{abi:t,functionName:n,result:r}=e,a=t[0];if(n){let e=i({abi:t,name:n});if(!e)throw new s(n,{docsPath:O});a=e}if(a.type!==`function`)throw new s(void 0,{docsPath:O});if(!a.outputs)throw new S(a.name,{docsPath:O});let o=(()=>{if(a.outputs.length===0)return[];if(a.outputs.length===1)return[r];if(Array.isArray(r))return r;throw new _(r)})();return b(a.outputs,o)}async function A(t){let{data:n,ccipRequest:r}=t,{args:[i]}=T({abi:e,data:n}),a=[],o=[];return await Promise.all(i.map(async(e,t)=>{try{o[t]=e.urls.includes(`x-batch-gateway:true`)?await A({data:e.data,ccipRequest:r}):await r(e),a[t]=!1}catch(e){a[t]=!0,o[t]=j(e)}})),k({abi:e,functionName:`query`,result:[a,o]})}function j(t){return t.name===`HttpRequestError`&&t.status?D({abi:e,errorName:`HttpError`,args:[t.status,t.shortMessage]}):D({abi:[p],errorName:`Error`,args:[`shortMessage`in t?t.shortMessage:t.message]})}function M(e,t){if(!l(e,{strict:!1}))throw new m({address:e});if(!l(t,{strict:!1}))throw new m({address:t});return e.toLowerCase()===t.toLowerCase()}var N=class extends g{constructor({callbackSelector:e,cause:t,data:n,extraData:r,sender:i,urls:a}){super(t.shortMessage||`An error occurred while fetching for an offchain result.`,{cause:t,metaMessages:[...t.metaMessages||[],t.metaMessages?.length?``:[],`Offchain Gateway Call:`,a&&[`  Gateway URL(s):`,...a.map(e=>`    ${f(e)}`)],`  Sender: ${i}`,`  Data: ${n}`,`  Callback selector: ${e}`,`  Extra data: ${r}`].flat(),name:`OffchainLookupError`})}},P=class extends g{constructor({result:e,url:t}){super(`Offchain gateway response is malformed. Response data must be a hex value.`,{metaMessages:[`Gateway URL: ${f(t)}`,`Response: ${n(e)}`],name:`OffchainLookupResponseMalformedError`})}},F=class extends g{constructor({sender:e,to:t}){super("Reverted sender address does not match target contract address (`to`).",{metaMessages:[`Contract address: ${t}`,`OffchainLookup sender address: ${e}`],name:`OffchainLookupSenderMismatchError`})}};const I=`0x556f1830`,L={name:`OffchainLookup`,type:`error`,inputs:[{name:`sender`,type:`address`},{name:`urls`,type:`string[]`},{name:`callData`,type:`bytes`},{name:`callbackFunction`,type:`bytes4`},{name:`extraData`,type:`bytes`}]};async function R(e,{blockNumber:n,blockTag:r,data:i,to:a}){let{args:o}=C({data:i,abi:[L]}),[s,c,l,u,d]=o,{ccipRead:f}=e,p=f&&typeof f?.request==`function`?f.request:z;try{if(!M(a,s))throw new F({sender:s,to:a});let{data:i}=await x(e,{blockNumber:n,blockTag:r,data:t([u,b([{type:`bytes`},{type:`bytes`}],[c.includes(`x-batch-gateway:true`)?await A({data:l,ccipRequest:p}):await p({data:l,sender:s,urls:c}),d])]),to:a});return i}catch(e){throw new N({callbackSelector:u,cause:e,data:i,extraData:d,sender:s,urls:c})}}async function z({data:e,sender:t,urls:r}){let i=Error(`An unknown error occurred.`);for(let a=0;a<r.length;a++){let o=r[a],s=o.includes(`{data}`)?`GET`:`POST`,c=s===`POST`?{data:e,sender:t}:void 0,l=s===`POST`?{"Content-Type":`application/json`}:{};try{let r=await fetch(o.replace(`{sender}`,t.toLowerCase()).replace(`{data}`,e),{body:JSON.stringify(c),headers:l,method:s}),a;if(a=r.headers.get(`Content-Type`)?.startsWith(`application/json`)?(await r.json()).data:await r.text(),!r.ok){i=new w({body:c,details:a?.error?n(a.error):r.statusText,headers:r.headers,status:r.status,url:o});continue}if(!v(a)){i=new P({result:a,url:o});continue}return a}catch(e){i=new w({body:c,details:e.message,url:o})}}throw i}export{R as offchainLookup,I as offchainLookupSignature};